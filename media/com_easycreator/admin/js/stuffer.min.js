var sortActions;window.addEvent("domready",function(){var a=new Sortables("#package-from, #package-to",{constrain:false,clone:true,revert:true})});function createFile(b,a){document.id("type1").value=b;document.id("type2").value=a;submitbutton("create_install_file")}function submitStuffer(a,c){c.addClass("ajax_loading16");if(document.id("package-to")==null){submitbutton(a);return}var d=document.id("package-to").getElements("li");var b=new Array();d.each(function(e){b.push(e.id)});document.id("packageElements").value=b.join(",");submitbutton(a)}var ecrStuffer=new Class({cnt_update:0,sortActions:null,init:function(){var a=document.id("actionButtons").getElements("div.display");a.each(function(b){b.setStyle("display","none");b.inject(document.id("actionWindow"))});a[0].setStyle("display","block");a=document.id("actionButtons").getElements("a");a.each(function(b){b.addEvent("mousedown",function(c){Stuffer.setActive(this.get("coords"));document.id("actionButtons").getElements("a").each(function(e,d){e.removeClass("active")});this.addClass("active")})});a[0].addClass("active")},setActive:function(a){document.id("actionWindow").getElements("div.display").each(function(c){var b=(a==c.get("title"))?"block":"none";c.setStyle("display",b)})},addUpdateServer:function(c,b,f,e){var a=document.id("updateServers");var d="";d+='<label class="inline">'+jgettext("URL")+'</label><input type="text" name="updateServers[url][]" value="'+b+'" /><br />';d+='<label class="inline">'+jgettext("Name")+'</label><input type="text" name="updateServers[name][]" value="'+c+'" /><br />';d+='<label class="inline">'+jgettext("Priority")+'</label><input type="text" name="updateServers[priority][]" value="'+e+'" /><br />';d+='<label class="inline">'+jgettext("Type")+'</label><input type="text" name="updateServers[type][]" value="'+f+'" /><br />';d+='<br /><span class="btn btn-mini" onclick="this.getParent().dispose();">';d+=jgettext("Delete");d+="</span>";new Element("div",{"class":"updateServer"}).set("html",d).inject(a)},newAction:function(c){var a=document.id("sel_actions");var e=document.id("sel_event");var b=a.options[a.selectedIndex].value;var d=e.options[e.selectedIndex].value;a.setStyle("outline","");if(""==b){a.setStyle("outline","1px solid red");return false}c.addClass("ajax_loading16");Stuffer.addAction(b,d,{});c.removeClass("ajax_loading16")},addAction:function(f,a,h){this.cnt_update+=1;a=(undefined==a)?"":a;h.event=a;var b=document.id("container_actions_"+a);var e="";var d=this.cnt_update;e+='<input type="hidden" name="actions['+a+"]["+d+']" value="'+f+'" />';title=f.charAt(0).toUpperCase();title+=f.substr(1);var i="";if("script"==f&&undefined!=h.script){console.log(h);i=h.script;var g=30;if(i.length>g){i='<span class="hasTip" title="'+i+'">...'+i.substr(i.length-g)+"</span>"}i=' - <code class="scriptName">'+i+"</code>"}var c=this.sortActions;new Request.JSON({async:false,url:ecrAJAXLink+"&controller=stuffer&task=getAction&type="+f+"&options="+JSON.stringify(h)+"&cnt="+this.cnt_update,onComplete:function(k){if(k.status){alert(k.message+k.debug);return false}e+='<div class="actionTitle"><i class="img icon16-move" style="cursor: move;" title="'+jgettext("Move")+'"></i><i class="img icon16-eye" style="cursor: help;" title="'+jgettext("Show settings")+'" onclick="Stuffer.toggleContainer(this, \'tgl_action_'+d+"');\"></i>"+title+i+'<span style="float: right;" class="btn btn-mini" onclick="this.getParent().getParent().dispose();">'+jgettext("Delete")+"</span></div>";e+='<div id="tgl_action_'+d+'" style="display: none;"><fieldset>'+k.message+"</fieldset></div>";var j=new Element("li",{style:"border: 1px solid silver; padding: 0.4em; margin: 0.2em;"}).set("html",e).inject(b);if(c){c.addItems(j)}}}).send()},initActions:function(a){this.sortActions=new Sortables("#"+a+" UL",{constrain:true,clone:true,revert:true,onStart:function(b){b.setStyle("background","#add8e6")},onComplete:function(b){b.setStyle("background","#fff")}})},toggleContainer:function(c,d){var b="icon16-eye";var a="icon16-eyeclosed";if(c.hasClass(a)){c.removeClass(a);c.addClass(b);c.title=jgettext("Show settings");document.id(d).setStyle("display","none")}else{c.removeClass(b);c.addClass(a);c.title=jgettext("Hide settings");document.id(d).setStyle("display","block")}},loadFilenameDefaults:function(a){a.addClass("ajax_loading16");new Request.JSON({url:ecrAJAXLink+"&controller=stuffer&task=getEcrParams",onComplete:function(c){a.removeClass("ajax_loading16");if(c.status){alert(c.message);return false}var b=JSON.decode(c.message);document.id("custom_name_1").set("value",b.custom_name_1);document.id("custom_name_2").set("value",b.custom_name_2);document.id("custom_name_3").set("value",b.custom_name_3);document.id("custom_name_4").set("value",b.custom_name_4)}}).send()},loadPreset:function(a){new Request.JSON({url:ecrAJAXLink+"&"+document.id("adminForm").toQueryString()+"&controller=stuffer&task=loadPreset",onRequest:function(){a.addClass("ajax_loading16")},onFailure:function(){a.removeClass("ajax_loading16");alert(jgettext("The request failed"))},onComplete:function(b){a.removeClass("ajax_loading16");if(undefined==b){return}if(b.status){alert(b.message);return}var g=JSON.decode(b.data);console.log(g);for(v in g){if("actions"==v){console.log("actions...");console.log(g[v]);$$("#container_action ul").each(function(h){console.log(h);h.empty()});document.id("container_action").getChildren().each(function(h){});for(var c=0;c<g[v].length;c++){var f=JSON.decode(g[v][c]);console.info(f);Stuffer.addAction(f.type,f.event,f)}}else{var d=document.id(v);switch(d.type){case"text":d.value=g[v];break;case"checkbox":d.checked=("1"==g[v])?"checked":"";break;case"radio":d.value=g[v];var e=document.id("lbl_"+d.id);if(undefined!=e){e.set("text",g[v])}break;case undefined:d.innerHTML=g[v];break;default:console.log("UNKNOWN: "+d.type)}}}}}).send()},savePreset:function(a){a.addClass("ajax_loading16");new Request({url:ecrAJAXLink+"&controller=stuffer&task=savePreset&"+document.id("adminForm").toQueryString(),onRequest:function(){message.setStyle("color","black");message.className="ajax_loading16";message.innerHTML=jgettext("Creating your package...");result.innerHTML=""},onComplete:function(c){var b=JSON.decode(c);message.innerHTML="";message.className="";document.id("ecrProgressBar").getParent().removeClass("active");if(b.status){message.innerHTML=b.message;message.setStyle("color","red")}else{result.innerHTML=b.message}stopPoll()}}).send()}});var Stuffer=new ecrStuffer();