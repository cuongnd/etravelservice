var EcrZiper=new Class({url:ecrAJAXLink,createPackage:function(){document.id("zipResult").setStyle("display","block");var b=document.id("ajaxMessage");var a=document.id("zipResultLinks");startPoll();new Request({url:this.url+"&"+document.id("adminForm").toQueryString()+"&controller=ziper&task=createPackage",onRequest:function(){b.setStyle("color","black");b.className="ajax_loading16";b.innerHTML=jgettext("Creating your package...");a.innerHTML=""},onComplete:function(d){var c=JSON.decode(d);b.innerHTML="";b.className="";document.id("ecrProgressBar").getParent().removeClass("active");if(c.status){b.innerHTML=c.message;a.innerHTML=c.debug}else{a.innerHTML=c.message}stopPoll()}}).send()},deleteZipFile:function(e,b){var d=document.id("ajaxMessage");var a=document.id("ajaxDebug");var c=new Fx.Morph(d,{});new Request({url:ecrAJAXLink+"&controller=ziper&task=delete&file_path="+e+"&file_name="+b,onRequest:function(){d.innerHTML=jgettext("Deleting...")},onComplete:function(f){resp=JSON.decode(f);d.set("text",resp.message);d.style.color="green";if(resp.status){d.style.color="red";a=resp.debug;return}else{$("row"+b).setStyle("display","none")}c.start({}).chain(function(){this.start.delay(1000,this,{opacity:0})}).chain(function(){d.style.display="none";this.start.delay(100,this,{opacity:1})})}}).send()},updateName:function(){var b=document.id("ajName");var c=document.id("loadStat_filename");var a=document.id("cst_format").value;new Request.JSON({url:ecrAJAXLink+"&controller=ziper&task=updateProjectName&ecr_project="+document.id("ecr_project").value+"&cst_format="+a,onRequest:function(){c.addClass("ajax_loading16")},onFailure:function(){c.removeClass("ajax_loading16")},onComplete:function(d){c.removeClass("ajax_loading16");b.innerHTML=d.message}}).send()},loadPreset:function(a){new Request.JSON({url:ecrAJAXLink+"&"+document.id("adminForm").toQueryString()+"&controller=stuffer&task=loadPreset",onRequest:function(){a.addClass("ajax_loading16")},onFailure:function(){a.removeClass("ajax_loading16");alert(jgettext("The request failed"))},onComplete:function(c){a.removeClass("ajax_loading16");if(undefined==c){return}if(c.status){alert(c.message);return}var f=JSON.decode(c.data);for(var b in f){if("actions"==b){EcrZiper.loadActions(f[b]);continue}console.log(b);var d=document.id(b);if(null==d){continue}switch(d.type){case"checkbox":d.checked=("1"==f[b])?"checked":"";break;case"radio":d.value=f[b];var e=document.id("lbl_"+d.id);if(undefined!=e){e.set("text",f[b])}break;case undefined:d.innerHTML=f[b];break;default:console.warn("UNKNOWN: "+d.type)}}EcrZiper.updateName()}}).send()},loadActions:function(f){var e=document.id("actionList");e.empty();var c="";for(var b=0;b<f.length;b++){var d=JSON.decode(f[b]);var a=new Element("li");if(""==c||c!=d.event){c=d.event;new Element("li").set("html","<strong>"+c+"</strong>").inject(e)}new Element("input",{type:"checkbox",name:"actions[]",id:"action_"+b,value:b,checked:"checked"}).inject(a);new Element("label",{"class":"inline","for":"action_"+b}).set("html",d.type).inject(a);if("script"==d.type){new Element("code",{"class":"scriptName"}).set("html",d.script).inject(a)}a.inject(e)}}});var EcrZiper=new EcrZiper;