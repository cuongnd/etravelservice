var EcrDeploy=new Class({Implements:[Options],options:{url:""},url:"",urlAdd:"",box:"",initialize:function(a){this.setOptions(a);this.url="index.php?option=com_easycreator&tmpl=component&format=raw&controller=deploy"},deployPackage:function(a){var b="";$$("table.adminlist input").each(function(e){if(e.checked){b+="&file[]="+e.value}});if(""==b){alert(jgettext("Please choose one or more files to deploy"));return false}this.urlAdd=b;var d=this._getCredentials(a,"deployPackages");var c={status:document.id(a+"DeployMessage"),debug:document.id(a+"DeployDebug"),display:document.id(a+"DeployDebug")};startPoll();this._send(c,d,php2js.sprintf(jgettext("Deploying to %s"),a),"getPackageList",a)},deployFiles:function(a){var b="";var e="";$$("div#syncTree div input").each(function(f){if(f.checked){if(f.value=="deleted"){e+="&deletedfiles[]="+f.id}else{b+="&files[]="+f.id}}});if(""==b&&""==e){alert(jgettext("Please choose one or more files to deploy"));return false}this.urlAdd=b+e;var d=this._getCredentials(a,"deployFiles");var c={status:document.id(a+"Message"),debug:document.id(a+"Debug"),display:document.id(a+"Debug")};startPoll();this._send(c,d,php2js.sprintf(jgettext("Deploying to %s"),a),"getSyncList",a)},getPackageList:function(a,d){var c=this._getCredentials(a,"getPackageList");c.logMode=(undefined==d)?"":d;var b={status:document.id("ajax"+a+"Message"),debug:document.id("ajax"+a+"Debug"),display:document.id(a+"Display")};startPoll();this._send(b,c,php2js.sprintf(jgettext("Obtaining downloads from: %s"),a))},getSyncList:function(a){var c={status:document.id("syncList"),debug:document.id("syncList"),display:document.id("syncList")};var b=this._getCredentials(a,"getSyncList");this._send(c,b,jgettext("Generating synchronization list..."))},deletePackage:function(b,a){try{var d=this._getCredentials(b,"deletePackage");switch(b){case"github":d.id=a;break;case"ftp":d.file=a;break;default:throw ("Unknown deploy target: "+b);break}var c={status:document.id("ajax"+b+"Message"),debug:document.id("ajax"+b+"Debug"),display:document.id(b+"Display")};startPoll();this._send(c,d,php2js.sprintf(jgettext("Deleting files on: %s"),b),"getPackageList",b)}catch(f){debug.innerHTML=f}},syncFiles:function(a){try{var c=this._getCredentials(a,"syncFiles");var b={status:document.id(a+"Message"),debug:document.id(a+"Debug"),display:document.id(a+"Display")};startPoll();this._send(b,c,php2js.sprintf(jgettext("Synchronizing files on: %s"),a))}catch(d){alert(d)}},saveUpdateFiles:function(){alert("he")},addUpdateFile:function(){var a=document.id("updateFiles");var b="";b+='<div class="buttons">';b+='<a href="javascript:;" class="btn" onclick="this.getParent().dispose();">';b+=jgettext("Delete");b+="</a>";b+='<a href="javascript:;" class="btn" onclick="EcrDeploy.addUpdateFiles(this);">'+jgettext("Add files")+"</a>";b+="</div>";var c=new Element("div",{style:"border: 1px dashed gray; padding: 0.4em; margin: 0.2em;"});c.set("html",b);c.inject(a)},addUpdateFiles:function(c){var b="";var a="hahaha";$$("table.adminlist input").each(function(d){if(d.checked){b+="&file[]="+d.value}});if(""==b){alert(jgettext("Please choose one or more files to deploy"));return false}document.id(c).inject(a)},addUpdateItem:function(c,f,d,e,b,h,g,a){html+=jgettext("URL")+': <input type="text" name="updateServers[url][]" value="'+url+'" /><br />';html+=jgettext("Name")+': <input type="text" name="updateServers[name][]" value="'+c+'" /><br />';html+=jgettext("Priority")+': <input type="text" size="2" name="updateServers[priority][]" value="'+priority+'" /> ';html+=jgettext("Type")+': <input type="text" size="8" name="updateServers[type][]" value="'+e+'" /><br />';return html},checkAll:function(a){a=(undefined==a)?"":"."+a;$$("div#syncTree div"+a+" input").each(function(b){b.checked="checked"})},uncheckAll:function(){$$("div#syncTree div input").each(function(a){a.checked=""})},_send:function(e,d,c,a,b){new Request({url:this.url+this.urlAdd,data:d,onRequest:function(){e.status.style.color="black";e.status.innerHTML=c;e.status.className="ajax_loading16"},onComplete:function(f){resp=JSON.decode(f);e.status.className="";if(resp.status){e.status.style.color="red";e.status.set("text",resp.message);e.debug.set("text",resp.debug)}else{e.status.set("text","");e.debug.set("text","");e.display.set("html",resp.message)}stopPoll();if(a){switch(a){case"getPackageList":EcrDeploy.getPackageList(b,"preserve");break;case"getSyncList":EcrDeploy.getSyncList(b);break;default:console.log("Unknown additinal:"+a);break}}},onFailure:function(){e.status.style.color="red";e.status.set("text","The request failed");e.status.className=""}}).send()},_getCredentials:function(b,a){var c=null;switch(b){case"ftp":c={ftpHost:document.id("ftpHost").value,ftpPort:document.id("ftpPort").value,ftpUser:document.id("ftpUser").value,ftpPass:document.id("ftpPass").value,ftpDirectory:document.id("ftpDirectory").value,ftpDownloads:document.id("ftpDownloads").value};break;case"github":c={owner:document.id("githubRepoOwner").value,repo:document.id("githubRepoName").value,user:document.id("githubUser").value,pass:document.id("githubPass").value};break;default:throw ("Unknown deploy targetx: "+b);break}c.task=a;c.deployTarget=b;c.ecr_project=document.id("ecr_project").value;return c}});var EcrDeploy=new EcrDeploy;